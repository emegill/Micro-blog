
<div class="user-info__container">
    <h1 class="user-info__full-name">
        <%= "#{@user.fname} #{@user.lname}"%>
    </h1>
    <p>Username: <%= @user.username %></p>
</div>

<% if @this_user %>
    <div class="user-details__container">
        <h3>Account details</h3>
        <div class="user-details__full-name">
            Name: <%= "#{@user.fname} #{@user.lname}" %>
        </div>
        <div class="user-details__email">
            Email address: <%= @user.email %>
        </div>
    </div>


    <div class="edit-user-modal">
        <form action="/edit_user" method="post">

            <div class="edit-user-modal__attribute edit-user__username">
                Username:
                <input type="text" name="username" value="<%= @user.username %>">
            </div>
            <div class="edit-user-modal__attribute edit-user__fname">
                First name:
                <input type="text" name="fname" value="<%= @user.fname %>">
            </div>
            <div class="edit-user-modal__attribute edit-user__lname">
                Last name:
                <input type="text" name="lname" value="<%= @user.lname %>">
            </div>
            <div class="edit-user-modal__attribute edit-user__email">
                Email address:
                <input type="text" name="email" value="<%= @user.email %>">
            </div>
            <div class="edit-user-modal__enter-password">
                Enter current password to change details:
                <input class="current-password-input-field" type="password" name="password_check" placeholder="Enter password">
                <button type="button" class="show-edit-password-btn">Change password</button>
            </div>

            <div class="edit-password__container">
                New password:
                <input class="new-password-input-field" type="password" name="password_new" placeholder="Enter new password">
                <input type="password" name="password" placeholder="Confirm password">
            </div>

            <input type="submit" value="Confirm edit">
            <button type="button" class="edit-user__cancel-btn">Cancel</button>
        </form>
    </div>
    <button class="edit-user-btn">
        Edit details
    </button>
    <button class="delete-user-btn">
        Delete account
    </button>
    <div class="delete-user-modal">
        <p>
            Are you sure you wish to delete your account? This will delete your blog posts and cannot be undone.
        </p>
        <form action="/delete_user" method="post">
            <input type="submit" value="Yes, delete account">
        </form>
        <button class="delete-user__cancel-btn">Cancel</button>
    </div>

    <div class="new-blog-form__container">
        <h2>Post new blog:</h2>
        <form id="new-blog-form" action="/create_blog" method="post">

            <input type="text" name="[blog]title" placeholder="Blog title">

            <input type="hidden" name="[blog]user_id" value="<%= @user.id %>">

            <div class="new-blog-form__content-input">
                <textarea form="new-blog-form" name="[blog]content" placeholder="Type your micro-blog here (max 150 characters)" maxlength="150" rows="3" cols="60"></textarea>
            </div>

            <input type="submit">
        </form>
    </div>

<a href="/favorites/<%= @user.id %>">View Favorites</a>

<% end %>

<div class="blog-list__container">
    <h2><%= @user.fname %>'s Blogs</h2>

    <% @blogs.each do |blog| %>

        <div class="blog-list__item-container">
            <div class="blog-list__blog-title">
                <%= blog.title %>
            </div>
            <div class="blog-list__blog-content">
                <%= blog.content %>
            </div>

            <% if @viewing_user %>

                <% if @favorites_blog_ids.include? blog.id %>
                    <% favorite = Favorite.where(user_id: session[:user_id], blog_id: blog.id)[0] %>
                    <div class="favorited-blog-heart"></div>
                    <form action="/destroy_favorite" method="post">
                        <input type="hidden" name="favorite_id" value="<%= favorite.id %>">
                        <input type="hidden" name="redirect_to" value="/account/<%= @user.id %>">
                        <input class="unfavorite-btn" type="submit" value="Unfavorite">
                    </form>
                <% else %>
                    <form action="/create_favorite" method="post">
                        <input type="hidden" name="[favorite]user_id" value="<%= session[:user_id] %>">
                        <input type="hidden" name="[favorite]blog_id" value="<%= blog.id %>">
                        <input type="hidden" name="redirect_to" value="/account/<%= @user.id %>">
                        <input class="favorite-btn" type="submit" value="Favorite">
                    </form>
                <% end %>

                <% if blog.user_id != @viewing_user.id %>
                    <form action="/create_reblog" method="post">
                        <input type="hidden" name="[reblog]original_blog_id" value="<%= blog.id %>">
                        <input type="hidden" name="[reblog]user_id" value="<%= @viewing_user.id %>">
                        <input type="hidden" name="[blog]user_id" value="<%= @viewing_user.id %>">
                        <input type="hidden" name="[blog]title" value="<%= blog.title %>">
                        <input type="hidden" name="[blog]content" value="<%= blog.content %>">
                        <input type="hidden" name="redirect_to" value="/account/<%= @viewing_user.id%>">
                        <input type="submit" value="Reblog">
                    </form>
                <% end %>

                <% if @this_user %>
                    <div class="update-blog-form__container">

                        <form id="update-blog-<%= blog.id %>-form" action="/update_blog" method="post">

                            <input type="text" name="title" value="<%= blog.title %>">

                            <input type="hidden" name="user_id" value="<%= @user.id %>">
                            <input type="hidden" name="blog_id" value="<%= blog.id %>">
                            <input type="hidden" name="redirect_to" value="/account/<%= @user.id %>">

                            <div class="new-blog-form__content-input">
                                <textarea form="update-blog-<%= blog.id %>-form" class="update-blog-form__textarea" name="content" maxlength="150" rows="3" cols="60"><%= blog.content %></textarea>
                            </div>

                            <input type="submit">
                            <button type="button" class="blog-list__cancel-edit-blog-btn">Cancel</button>
                        </form>
                    </div>
                    <button class="blog-list__edit-blog-btn">Edit</button>
                    <button class="blog-list__del-blog-btn">Delete blog</button>
                    <div class="delete-blog-modal">
                        <p>Are you sure you wish to delete this blog?</p>
                        <form id="delete-blog-form" action="/destroy_blog/<%= blog.id %>" method="post">
                            <input type="hidden" name="redirect_to" value="/account/<%= @user.id %>">
                            <input type="submit" value="Yes, delete">
                            <button type="button" class="delete-blog__cancel-btn">Cancel</button>
                        </form>
                    </div>
                <% end %>
            <% end %>
        </div>
    <% end %>
</div>

<script type="text/javascript" src="/js/update_blog.js"></script>
<script type="text/javascript" src="/js/update_user.js"></script>
